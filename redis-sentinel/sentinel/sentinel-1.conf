# =============================================================================
# Redis Sentinel Configuration - Node 1
# =============================================================================
# Sentinel monitors Redis master and orchestrates automatic failover.
# This is one of 3 Sentinel nodes forming a quorum.
# =============================================================================

# -----------------------------------------------------------------------------
# NETWORK CONFIGURATION
# -----------------------------------------------------------------------------

# Sentinel port
port 26379

# Bind to all interfaces for Docker networking
bind 0.0.0.0

# Disable protected mode for Docker internal networking
protected-mode no

# -----------------------------------------------------------------------------
# SENTINEL IDENTIFICATION
# -----------------------------------------------------------------------------

# Unique Sentinel ID (auto-generated if not set, but explicit is better)
# Each Sentinel needs a unique ID
sentinel myid 1111111111111111111111111111111111111111

# Announce IP to other Sentinels (Docker hostname)
sentinel announce-ip sentinel-1
sentinel announce-port 26379

# -----------------------------------------------------------------------------
# MASTER MONITORING
# -----------------------------------------------------------------------------
# This is the core Sentinel configuration.

# Monitor a master named "kasagi-master"
# Format: sentinel monitor <master-name> <ip> <port> <quorum>
# 
# <master-name>: Logical name for this master (used in client connections)
# <ip>: Master's IP or hostname
# <port>: Master's port
# <quorum>: Number of Sentinels that must agree master is down
#
# Quorum of 2 means 2 out of 3 Sentinels must agree for failover
# This prevents split-brain scenarios
sentinel monitor kasagi-master redis-master 6379 2

# -----------------------------------------------------------------------------
# FAILOVER CONFIGURATION
# -----------------------------------------------------------------------------

# Time (ms) master must be unreachable before considering it down
# Lower values = faster failover but more false positives
# 5000ms (5 seconds) is a good balance for real-time systems
sentinel down-after-milliseconds kasagi-master 5000

# Number of replicas to reconfigure in parallel during failover
# Higher = faster failover but more load on new master
# 1 is safest, increase for faster recovery
sentinel parallel-syncs kasagi-master 1

# Timeout (ms) for failover operations
# If failover doesn't complete in this time, it's aborted
# 60 seconds allows for slow network conditions
sentinel failover-timeout kasagi-master 60000

# -----------------------------------------------------------------------------
# NOTIFICATION SCRIPTS (OPTIONAL)
# -----------------------------------------------------------------------------
# Execute scripts on Sentinel events for alerting/automation.

# Script called when master changes state (any state)
# sentinel notification-script kasagi-master /scripts/notify.sh

# Script called when failover starts
# sentinel client-reconfig-script kasagi-master /scripts/reconfig.sh

# -----------------------------------------------------------------------------
# AUTHENTICATION (IF REQUIRED)
# -----------------------------------------------------------------------------
# If your Redis master requires authentication:

# Password to authenticate with master/replicas
# sentinel auth-pass kasagi-master <your-password>

# Username for ACL authentication (Redis 6+)
# sentinel auth-user kasagi-master <your-username>

# Password for Sentinel-to-Sentinel communication
# requirepass <sentinel-password>

# -----------------------------------------------------------------------------
# SECURITY
# -----------------------------------------------------------------------------

# Rename dangerous commands (optional but recommended)
# sentinel rename-command kasagi-master CONFIG CONFIG_RENAMED

# Deny script execution
sentinel deny-scripts-reconfig yes

# -----------------------------------------------------------------------------
# LOGGING
# -----------------------------------------------------------------------------

# Log level
loglevel notice

# Log to stdout for Docker
logfile ""

# -----------------------------------------------------------------------------
# ADVANCED SETTINGS
# -----------------------------------------------------------------------------

# Resolve hostnames to IP addresses
# Important for Docker DNS resolution
sentinel resolve-hostnames yes

# Announce resolved hostnames (vs IPs) to other Sentinels
sentinel announce-hostnames yes

# Working directory
dir /data

# ACLFILE (if using Redis ACL)
# aclfile /etc/redis/sentinel-acl.conf

